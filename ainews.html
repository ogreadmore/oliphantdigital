<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI News Aggregator</title>
  <!-- Uses AllOrigins proxy and DOMParser for CORS-free RSS parsing -->
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    h1 { text-align: center; margin-bottom: 20px; }
    #feed-controls, #section-controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
    input[type=text] { width: 220px; padding: 6px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap; }
    button#add-feed { background: #2ecc71; color: #fff; }
    button#add-feed:hover { background: #27ae60; }
    button#add-section { background: #3498db; color: #fff; }
    button#add-section:hover { background: #2980b9; }
    button#reset-sections { background: #f39c12; color: #fff; }
    button#reset-sections:hover { background: #d35400; }
    #feed-list, #section-list { list-style: none; padding: 0; max-width: 800px; margin: 0 auto 20px; }
    #feed-list li, #section-list li { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 8px 12px; margin-bottom: 5px; border-radius: 4px; flex-wrap: wrap; }
    #feed-list li span.tags { font-size: 0.9em; color: #555; margin: 0 10px; }
    #feed-list li button.remove, #feed-list li button.edit-tags, #section-list li button.remove { background: #e74c3c; color: #fff; margin-left: 5px; }
    #feed-list li button.remove:hover, #feed-list li button.edit-tags:hover, #section-list li button.remove:hover { background: #c0392b; }
    #news-container { max-width: 1000px; margin: 0 auto; }
    .section { margin-bottom: 30px; }
    .section h2 { background: #333; color: #fff; padding: 8px 12px; border-radius: 4px; margin: 0; }
    .section-news { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 10px; }
    .news-item { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .news-item a { font-size: 1em; font-weight: bold; color: #333; text-decoration: none; }
    .news-item a:hover { text-decoration: underline; }
    .news-item .meta { margin-top: 8px; font-size: 0.8em; color: #666; }
    .error { color: red; text-align: center; }
    .tag-toggle { cursor: pointer; padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; display: inline-block; }
    .tag-toggle.active { background: #2c3e50; color: #fff; border-color: #2c3e50; }
  </style>
</head>
<body>
  <h1>AI News Aggregator</h1>

  <!-- Feed management -->
  <div id="feed-controls">
    <input id="new-feed-url" type="text" placeholder="RSS feed URL" />
    <input id="new-feed-tags" type="text" placeholder="Tags (comma-separated)" />
    <button id="add-feed">Add Feed</button>
  </div>
  <ul id="feed-list"></ul>

  <!-- Section (tag) management -->
  <div id="section-controls">
    <input id="new-section-name" type="text" placeholder="New section/tag name" />
    <button id="add-section">Add Section</button>
    <button id="reset-sections">Reset Sections</button>
  </div>
  <ul id="section-list"></ul>

  <!-- News display -->
  <div id="news-container"><p>Loading news...</p></div>

  <script>
    // Initial feeds, each tagged to match default sections
    let feeds = [
      { url: 'https://openai.com/blog/rss',                   tags: ['ChatGPT'],   added: Date.now() },
      { url: 'https://ai.googleblog.com/feeds/posts/default?alt=rss', tags: ['Gemini'],     added: Date.now() },
      { url: 'https://blog.anthropic.com/rss.xml',             tags: ['Claude'],    added: Date.now() },
      { url: 'https://techcrunch.com/tag/automation/feed/',     tags: ['Automation'],added: Date.now() },
      { url: 'https://techcrunch.com/tag/chatbots/feed/',       tags: ['Agents'],    added: Date.now() },
      { url: 'https://dev.to/feed/tagged/ai',                  tags: ['Coding'],    added: Date.now() },
      { url: 'https://www.technologyreview.com/feed/?tag=ai',   tags: ['Tools'],     added: Date.now() },

  // --- Core LLM blogs ---
  { url: 'https://openai.com/blog/rss',                     tags:['ChatGPT'],   added:Date.now() },
  { url: 'https://ai.googleblog.com/feeds/posts/default?alt=rss', tags:['Gemini'],     added:Date.now() },
  { url: 'https://blog.anthropic.com/rss.xml',               tags:['Claude'],    added:Date.now() },

  // --- Automation news (agents, RPA, orchestration) ---
  { url: 'https://techcrunch.com/tag/automation/feed/',       tags:['Automation'],added:Date.now() },
  { url: 'https://techcrunch.com/tag/chatbots/feed/',         tags:['Agents'],    added:Date.now() },

  // --- Tools & platforms (frameworks, libraries, infra) ---
  { url: 'https://www.technologyreview.com/feed/?tag=ai',     tags:['Tools'],     added:Date.now() },
  { url: 'https://huggingface.co/blog/rss.xml',               tags:['Tools'],     added:Date.now() },
  { url: 'https://www.paperswithcode.com/rss',                tags:['Tools'],     added:Date.now() },

  // --- Coding tutorials & deep-dives (optional) ---
  { url: 'https://towardsdatascience.com/feed',               tags:['Coding'],    added:Date.now() },
  { url: 'https://dev.to/feed',                              tags:['Coding'],    added:Date.now() },

    ];

    // Default section names & order
    const defaultSectionNames = [
      'Most recent','ChatGPT','Gemini','Claude','Automation','Agents','Coding','Tools'
    ];
    let sections = defaultSectionNames.map(name => ({ name, active: true }));

    // DOM references
    const feedListEl       = document.getElementById('feed-list');
    const sectionListEl    = document.getElementById('section-list');
    const newsContainer    = document.getElementById('news-container');
    const newFeedUrlInput  = document.getElementById('new-feed-url');
    const newFeedTagsInput = document.getElementById('new-feed-tags');
    const newSectionInput  = document.getElementById('new-section-name');
    const addFeedBtn       = document.getElementById('add-feed');
    const addSectionBtn    = document.getElementById('add-section');
    const resetSectionsBtn = document.getElementById('reset-sections');

    function renderFeedList() {
      feedListEl.innerHTML = '';
      feeds.forEach((feed, i) => {
        const li = document.createElement('li');
        const urlSpan = document.createElement('span');
        urlSpan.textContent = feed.url;
        const tagsSpan = document.createElement('span');
        tagsSpan.className = 'tags';
        tagsSpan.textContent = '[' + feed.tags.join(', ') + ']';

        const editBtn = document.createElement('button');
        editBtn.className = 'edit-tags';
        editBtn.textContent = 'Edit Tags';
        editBtn.onclick = () => {
          const t = prompt('Tags (comma-separated)', feed.tags.join(', '));
          if (t !== null) {
            feed.tags = t.split(',').map(x => x.trim()).filter(x => x);
            renderFeedList(); renderSectionList(); loadNews();
          }
        };

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove';
        removeBtn.textContent = 'Remove';
        removeBtn.onclick = () => {
          feeds.splice(i,1);
          renderFeedList(); renderSectionList(); loadNews();
        };

        li.append(urlSpan, tagsSpan, editBtn, removeBtn);
        feedListEl.appendChild(li);
      });
    }

    function renderSectionList() {
      sectionListEl.innerHTML = '';
      sections.forEach((sec, i) => {
        const li = document.createElement('li');
        const tagBtn = document.createElement('span');
        tagBtn.textContent = sec.name;
        tagBtn.className = 'tag-toggle' + (sec.active ? ' active' : '');
        tagBtn.onclick = () => {
          sec.active = !sec.active;
          renderSectionList(); loadNews();
        };
        li.append(tagBtn);

        // only non-defaults get a remove button
        if (!defaultSectionNames.includes(sec.name)) {
          const rm = document.createElement('button');
          rm.className = 'remove';
          rm.textContent = 'Remove';
          rm.onclick = () => {
            sections.splice(i,1);
            renderSectionList(); loadNews();
          };
          li.append(rm);
        }

        sectionListEl.appendChild(li);
      });
    }

    addFeedBtn.onclick = () => {
      const url  = newFeedUrlInput.value.trim();
      const tags = newFeedTagsInput.value.split(',').map(x=>x.trim()).filter(x=>x);
      if (url && !feeds.some(f=>f.url===url)) {
        feeds.push({url,tags,added:Date.now()});
        newFeedUrlInput.value=''; newFeedTagsInput.value='';
        renderFeedList(); renderSectionList(); loadNews();
      }
    };

    addSectionBtn.onclick = () => {
      const name = newSectionInput.value.trim();
      if (name && !sections.some(s=>s.name===name)) {
        sections.push({name,active:true});
        newSectionInput.value='';
        renderSectionList(); loadNews();
      }
    };

    resetSectionsBtn.onclick = () => {
      sections = defaultSectionNames.map(n=>({name:n,active:true}));
      renderSectionList(); loadNews();
    };

    // fetch + parse RSS via AllOrigins proxy
    async function fetchFeed(feed) {
      try {
        const proxied = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(feed.url);
        const res = await fetch(proxied);
        if (!res.ok) return [];
        const xmlText = await res.text();
        const doc = new DOMParser().parseFromString(xmlText, 'application/xml');
        const items = Array.from(doc.querySelectorAll('item'));
        return items.map(item => ({
          title:   item.querySelector('title')?.textContent || '',
          link:    item.querySelector('link')?.textContent || '',
          pubDate: new Date(item.querySelector('pubDate')?.textContent || Date.now()),
          source:  new URL(feed.url).hostname,
          tags:    feed.tags,
          added:   feed.added
        }));
      } catch (e) {
        console.warn('Feed error:', feed.url);
        return [];
      }
    }

    // load and render all sections
    async function loadNews() {
      newsContainer.innerHTML = '<p>Loading news...</p>';
      const batches = await Promise.all(feeds.map(fetchFeed));
      const all = batches.flat();
      newsContainer.innerHTML = '';

      sections.forEach(sec => {
        if (!sec.active) return;
        let list;
        if (sec.name === 'Most recent') {
          list = all.slice().sort((a,b)=>b.pubDate - a.pubDate);
        } else {
          const key = sec.name.toLowerCase();
          list = all
            .filter(a => a.tags.includes(sec.name) || a.title.toLowerCase().includes(key))
            .sort((a,b)=>b.pubDate - a.pubDate);
        }

        const wrap = document.createElement('div');
        wrap.className = 'section';
        const h2 = document.createElement('h2');
        h2.textContent = sec.name;
        wrap.appendChild(h2);

        const grid = document.createElement('div');
        grid.className = 'section-news';

        if (list.length) {
          list.slice(0,10).forEach(item => {
            const card = document.createElement('div');
            card.className = 'news-item';
            card.innerHTML =
              `<a href="${item.link}" target="_blank" rel="noopener">${item.title}</a>` +
              `<div class="meta">${item.source} • ${item.pubDate.toLocaleString()}</div>`;
            grid.appendChild(card);
          });
        } else {
          const p = document.createElement('p');
          p.className = 'error';
          p.textContent = 'No articles for this section.';
          grid.appendChild(p);
        }

        wrap.appendChild(grid);
        newsContainer.appendChild(wrap);
      });

      if (!newsContainer.children.length) {
        newsContainer.innerHTML = '<p class="error">No articles to display for active sections.</p>';
      }
    }

    // initial render
    renderFeedList();
    renderSectionList();
    loadNews();
  </script>
</body>
</html>
